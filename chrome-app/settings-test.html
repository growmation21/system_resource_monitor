<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings Panel Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-controls {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .test-button {
            background: #0078d4;
            border: none;
            border-radius: 4px;
            color: #fff;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #106ebe;
        }
        
        .status {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .header {
            background: #2d2d2d;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-toggle {
            background: none;
            border: none;
            color: #ccc;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .settings-toggle:hover {
            background: #555;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Settings Panel Test</h1>
        
        <div class="header">
            <h2>System Resource Monitor</h2>
            <button id="settings-toggle" class="settings-toggle">⚙️</button>
        </div>
        
        <div class="test-controls">
            <h3>Test Controls</h3>
            <button class="test-button" onclick="testShowSettings()">Show Settings Panel</button>
            <button class="test-button" onclick="testHideSettings()">Hide Settings Panel</button>
            <button class="test-button" onclick="testToggleSettings()">Toggle Settings Panel</button>
            <button class="test-button" onclick="testExportSettings()">Export Settings</button>
            <button class="test-button" onclick="testResetSettings()">Reset Settings</button>
            <button class="test-button" onclick="showCurrentSettings()">Show Current Settings</button>
            <button class="test-button" onclick="testColorPreset()">Test Color Preset</button>
            <button class="test-button" onclick="testNotificationAlert()">Test Notification</button>
            <button class="test-button" onclick="testAdvancedFeatures()">Test Advanced Features</button>
        </div>
        
        <div id="status" class="status">
            Settings panel test ready. Click the buttons above to test functionality.
        </div>
        
        <div id="monitors" style="display: none;">
            <div id="monitors-content"></div>
        </div>
    </div>
    
    <!-- Mock SystemMonitor for testing -->
    <script>
        class MockSystemMonitor {
            constructor() {
                this.isConnected = true;
                this.lastData = {
                    gpu: [
                        { name: 'NVIDIA GeForce RTX 3070', gpu_temperature: 65, gpu_utilization: 45, vram_used: 4000, vram_total: 8000 },
                        { name: 'NVIDIA GeForce RTX 3060', gpu_temperature: 58, gpu_utilization: 23, vram_used: 2500, vram_total: 12000 }
                    ]
                };
                this.progressBars = new Map();
            }
            
            setRefreshRate(rate) {
                updateStatus(`Refresh rate set to ${rate}ms`);
            }
            
            updateMonitorVisibility(enabledMonitors) {
                updateStatus(`Monitor visibility updated: ${JSON.stringify(enabledMonitors)}`);
            }
            
            getLastData() {
                return this.lastData;
            }
        }
        
        // Initialize mock system
        let systemMonitor;
        let settingsPanel;
        
        function updateStatus(message) {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            status.innerHTML += `<br>[${timestamp}] ${message}`;
            status.scrollTop = status.scrollHeight;
        }
        
        // Test functions
        function testShowSettings() {
            if (settingsPanel) {
                settingsPanel.show();
                updateStatus('Settings panel shown');
            }
        }
        
        function testHideSettings() {
            if (settingsPanel) {
                settingsPanel.hide();
                updateStatus('Settings panel hidden');
            }
        }
        
        function testToggleSettings() {
            if (settingsPanel) {
                settingsPanel.toggle();
                updateStatus('Settings panel toggled');
            }
        }
        
        function testExportSettings() {
            if (settingsPanel) {
                settingsPanel.exportSettings();
                updateStatus('Settings exported');
            }
        }
        
        function testResetSettings() {
            if (settingsPanel) {
                settingsPanel.resetToDefaults();
                updateStatus('Settings reset to defaults');
            }
        }
        
        function showCurrentSettings() {
            if (settingsPanel) {
                const settings = settingsPanel.getSettings();
                updateStatus(`Current settings: ${JSON.stringify(settings, null, 2)}`);
            }
        }
        
        function testColorPreset() {
            if (settingsPanel) {
                settingsPanel.applyColorPreset('cool');
                updateStatus('Applied cool color preset');
            }
        }
        
        function testNotificationAlert() {
            if (settingsPanel) {
                settingsPanel.testNotification('Test notification from settings panel!', 'test');
                updateStatus('Test notification triggered');
            }
        }
        
        function testAdvancedFeatures() {
            if (settingsPanel) {
                // Test various advanced features
                settingsPanel.centerWindow();
                settingsPanel.refreshAvailableDrives();
                settingsPanel.applyColorScheme();
                settingsPanel.applyLayout();
                settingsPanel.applyPerformanceSettings();
                updateStatus('Advanced features tested: window centering, drive refresh, color scheme, layout, and performance settings');
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            systemMonitor = new MockSystemMonitor();
            updateStatus('Mock SystemMonitor initialized');
            
            try {
                settingsPanel = new SettingsPanel(systemMonitor);
                updateStatus('SettingsPanel initialized successfully');
                
                // Set up event listeners
                document.addEventListener('settingsChanged', (event) => {
                    updateStatus(`Settings changed: ${JSON.stringify(event.detail, null, 2)}`);
                });
                
                document.addEventListener('monitorVisibilityChanged', (event) => {
                    updateStatus(`Monitor visibility changed: ${JSON.stringify(event.detail)}`);
                });
                
                // Trigger system monitor ready event
                setTimeout(() => {
                    document.dispatchEvent(new CustomEvent('systemMonitorReady'));
                    updateStatus('SystemMonitor ready event dispatched');
                }, 500);
                
            } catch (error) {
                updateStatus(`Error initializing SettingsPanel: ${error.message}`);
                console.error(error);
            }
        });
    </script>
    
    <!-- Include the settings panel -->
    <script src="settings-panel.js"></script>
</body>
</html>
